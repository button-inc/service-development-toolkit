name: Happo CI
on:
  push:
    branches: [563-happo]
  pull_request:
    branches: [563-happo]
jobs:
  happo:
    runs-on: ubuntu-latest
    # defaults:
    #   run:
    #     working-directory: ./packages/bcgov-theme
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 100
      - uses: actions/setup-node@v3
        with:
          node-version: 16
      - run: |
          yarn
          yarn bootstrap
          yarn llink
          yarn build
          yarn happo-ci-github-actions

        # working-directory: /app/packages/button-theme
        env:
          HAPPO_COMMAND: /home/runner/work/service-development-toolkit/service-development-toolkit/node_modules/happo.io/build/cli.js
          HAPPO_API_KEY: ${{ secrets.HAPPO_API_KEY }}
          HAPPO_API_SECRET: ${{ secrets.HAPPO_API_SECRET }}
  # yarn
  # yarn bootstrap
  # yarn llink
  # yarn build
  # yarn happo-ci-github-actions
#   runs-on: ubuntu-latest
#   steps:
#     - uses: actions/checkout@v2
#       with:
#         fetch-depth: 100
#     - name: Install asdf
#       uses: asdf-vm/actions/setup@v1
#     - uses: actions/cache@v2
#       id: asdf-cache
#       with:
#         path: |
#           /home/runner/.asdf
#         key: ${{ runner.os }}-asdf-${{ hashFiles('**/.tool-versions') }}
#     - name: Install asdf tools
#       run: |
#         cat .tool-versions | cut -f 1 -d ' ' | xargs -n 1 asdf plugin-add || true
#         asdf plugin-update --all
#         asdf install
#         asdf reshim
#     - name: Get yarn cache directory path
#       id: yarn-cache-dir-path
#       run: echo "::set-output name=dir::$(yarn cache dir)"
#     - uses: actions/cache@v2
#       id: yarn-cache # use this to check for `cache-hit` (`steps.yarn-cache.outputs.cache-hit != 'true'`)
#       with:
#         path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
#         key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
#         restore-keys: |
#           ${{ runner.os }}-yarn-
#     - name: Install Yarn Dependencies
#       run: |
#         yarn
#     - name: Unit test
#       run: |
#         yarn llink
#         yarn build
#         yarn happo-ci-github-actions
#       env:
#         HAPPO_API_KEY: ${{ secrets.HAPPO_API_KEY }}
#         HAPPO_API_SECRET: ${{ secrets.HAPPO_API_SECRET }}
# INSTALL_CMD: yarn happo yarn happo-ci-github-actions
